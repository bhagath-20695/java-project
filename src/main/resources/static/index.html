<script>
    let userId = null;  // ✅ Store userId globally

    async function registerUser() {
        const username = document.getElementById("register-username").value;
        const password = document.getElementById("register-password").value;

        const response = await fetch("/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        const data = await response.json();
        if (response.ok) {
            alert(data.message);
            userId = data.userId;  // ✅ Save userId
            localStorage.setItem("userId", userId);
        } else {
            alert("Registration Failed: " + data.message);
        }
    }

    async function loginUser() {
        const username = document.getElementById("login-username").value;
        const password = document.getElementById("login-password").value;

        const response = await fetch("/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        const data = await response.json();
        if (response.ok) {
            alert(data.message);
            userId = data.userId;  // ✅ Save userId
            localStorage.setItem("userId", userId);
        } else {
            alert("Login Failed: " + data.message);
        }
    }

    async function getCreditScore() {
        const userId = localStorage.getItem("userId");
        if (!userId) {
            alert("Please log in first.");
            return;
        }

        const response = await fetch(`/credit-score/${userId}`, { method: "GET" });

        if (!response.ok) {
            alert("Credit Score Fetch Failed");
            return;
        }

        const data = await response.json();
        document.getElementById("credit-score-result").innerText = "Credit Score: " + data.score;
    }
</script>
